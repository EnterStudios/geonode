{% extends "page_layout.html" %}
{% load i18n %}

{% block title %} {{ layer.typename }} {% endblock %}

{% block header_append %}
    <script type="text/javascript">
        Ext.onReady(function() {
            var config = {
                /* This option works around issue #109
                 * until http://trac.openlayers.org/ticket/2178
                 * is fixed.
                 */
                alignToGrid: true,
                proxy: "/proxy/?url=",

                /* The URL to a REST map configuration service.  This service 
                 * provides listing and, with an authenticated user, saving of 
                 * maps on the server for sharing and editing.
                 */
                rest: "/maps/",
                wms: {
                    "capra": "{{ GEOSERVER_BASE_URL }}wms"
                },
                map: {
                    "layers": [{"wms": "capra", "name": "{{layer.typename}}"}],
                    "center": [-84.7, 12.8], 
                    "zoom": 7
                },
                backgroundLayers: {{ background|safe }},
                renderTo: "preview_map",
                height: 350
            };

            app = new LayerPreview(config);

            Ext.get(Ext.DomQuery.select("input[@name='style']")).on("click", function(evt, elem) {
                app.setPreviewStyle(elem.value);
            });
        });
    </script>
{% endblock %}

{% block main %}
<div id="description"> <h3> {{ layer.typename }} </h3> </div>
<p> <strong>{% trans "Abstract" %}:</strong> {{ layer.metadata.abstract|default:_("No abstract for this layer.") }} </p>
<p> <strong>{% trans "Type" %}:</strong> {% trans "No layer type specified." %} </p>
<p> <strong>{% trans "Keywords" %}:</strong> {{ layer.metadata.keywords|join:", " }}</p>
<p> <strong>{% trans "Citation" %}:</strong> 
    {{ layer.metadata.attribution|default:_("No attribution information for this layer.") }}
</p>
<p> <strong>{% trans "Contact" %}:</strong>
    {{ layer.metadata.attribution|default:_("No attribution information for this layer.") }}
</p>
<p> <strong>{% trans "Attributes" %}:</strong> 
    {{ layer.metadata.schema|default:_("No schema available for this layer.") }}
</p>
<p> <strong>{% trans "Native SRS" %}:</strong> {{ layer.metadata.crsOptions.0|default:_("No SRS specified.") }} </p>
<div id="preview_map"></div>
{% endblock %}

{% block sidebar %}
    <h3> {% trans "Download" %} </h3>
    <p> <strong>{% trans "Data" %}: </strong>
        {% for type, link in layer.download_links %}
            <a href="{{link}}">{{type}}</a>
        {% endfor %}
    </p>
	{% if user.is_authenticated %}
		<p><a href="">Remove Layer</a></p>
	{% else %}
	
	{% endif %}
    <p> <strong>{% trans "Metadata" %}: </strong>
        {% for type, link in layer.metadata_links %}
            <a href="{{link}}">{{type}}</a>
        {% endfor %}
    </p>
    <h3> {% trans "Maps" %} </h3>
    <p> {% trans "The following maps use this data set" %}:
        <ul>
            {% for map in layer.maps %} 
            <li> <a href="{{map.get_absolute_url}}">{{map.title}}</a> </li>
            {% endfor %}
        </ul>
    </p>

    <h3> {% trans "Styles" %} </h3>
    <p> {% trans "The following styles are associated with this data set.  Choose a style to view it in the preview to the left.  Click on a style name to view or edit the style." %}
    <br/>
        {% for name, info in layer.styles.items %} 
            <input type="radio" name="style" value="{{name}}"/> {{ info.title }} <br/>
        {% endfor %}
    </p>

    {% if user.is_authenticated %}
        <h3> {% trans "Manage" %} </h3>
        {% trans "In the future, we will provide tools to" %}:
        <ul>
            <li> {% trans "Edit metadata" %} </li>
            <li> {% trans "Delete layer" %} </li>
            <li> {% trans "Upload a new version of this data" %} </li>
        </ul>
    {% endif %}
{% endblock %}
